<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MATGAME Pro - Academia da Matem√°tica</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-color);
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        /* Temas */
        :root {
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: white;
            --text-color: #333;
            --border-color: #e0e0e0;
            --primary-color: #667eea;
            --success-color: #4CAF50;
            --error-color: #f44336;
            --warning-color: #ff9800;
        }

        [data-theme="dark"] {
            --bg-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            --card-bg: #2c3e50;
            --text-color: #ecf0f1;
            --border-color: #34495e;
            --primary-color: #3498db;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }

        .header {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .title {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .theme-toggle {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stats-panel {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            text-align: center;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            border-color: var(--primary-color);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9em;
            margin-top: 5px;
            opacity: 0.8;
        }

        .level-section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .level-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .level-btn {
            padding: 12px 20px;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        .level-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .level-btn:hover {
            transform: translateY(-2px);
        }

        .game-settings {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .setting-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .checkbox-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .numbers-section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 3px solid var(--primary-color);
        }

        .number-display {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .number-box {
            background: var(--primary-color);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 1.8em;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
            animation: numberPulse 0.5s ease;
        }

        @keyframes numberPulse {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .timer-section {
            text-align: center;
            margin: 20px 0;
        }

        .timer {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .generate-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            display: block;
            margin: 0 auto;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .exercises {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .exercise-card {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .exercise-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .exercise-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .exercise-problem {
            font-size: 1.6em;
            margin: 20px 0;
            color: var(--text-color);
            font-weight: bold;
        }

        .answer-input {
            width: 100px;
            padding: 12px;
            font-size: 1.2em;
            text-align: center;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            margin: 15px 0;
            background: var(--card-bg);
            color: var(--text-color);
            transition: all 0.3s;
        }

        .answer-input:focus {
            border-color: var(--primary-color);
            outline: none;
            transform: scale(1.05);
        }

        .result {
            margin-top: 15px;
            font-weight: bold;
            font-size: 1.1em;
            min-height: 30px;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .correct {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
            border: 2px solid var(--success-color);
            animation: correctPulse 0.6s ease;
        }

        .incorrect {
            background: rgba(244, 67, 54, 0.1);
            color: var(--error-color);
            border: 2px solid var(--error-color);
            animation: shake 0.5s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .tip-box {
            background: rgba(255, 152, 0, 0.1);
            border: 2px solid var(--warning-color);
            color: var(--warning-color);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .check-btn {
            background: var(--error-color);
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 1.3em;
            border-radius: 15px;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .check-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .score-section {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .score {
            font-size: 1.5em;
            margin: 15px 0;
            font-weight: bold;
        }

        .medal {
            font-size: 3em;
            margin: 20px 0;
            animation: medalSpin 1s ease;
        }

        @keyframes medalSpin {
            0% { transform: rotate(0deg) scale(0); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .streak-display {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 1.2em;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, var(--success-color), #8bc34a);
            border-radius: 10px;
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn-secondary {
            background: #9e9e9e;
            color: white;
        }

        .btn-secondary:hover {
            background: #757575;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: #5a6fd8;
            transform: translateY(-2px);
        }

        .history-section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .error-analysis {
            margin: 15px 0;
            padding: 15px;
            background: rgba(244, 67, 54, 0.05);
            border-left: 4px solid var(--error-color);
            border-radius: 5px;
        }

        .share-section {
            text-align: center;
            margin: 20px 0;
        }

        .share-btn {
            background: #25d366;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 0 5px;
            transition: all 0.3s;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .hidden {
            display: none !important;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 30px;
            border-radius: 15px;
            max-width: 500px;
            width: 90%;
            text-align: center;
        }

        .sound-controls {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .sound-toggle {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header { flex-direction: column; gap: 15px; }
            .title { font-size: 2em; }
            .exercises { grid-template-columns: 1fr; }
            .level-selector { justify-content: center; }
            .game-settings { justify-content: center; }
        }
    </style>
</head>
<body data-theme="light">
    <div class="container">
        <!-- Header com controles -->
        <div class="header">
            <div class="title">üßÆ MATGAME PRO</div>
            <div class="header-controls">
                <div class="sound-controls">
                    <span>üîä</span>
                    <button class="sound-toggle" onclick="toggleSound()" id="soundBtn">ON</button>
                </div>
                <button class="theme-toggle" onclick="toggleTheme()">üåô Tema</button>
                <button class="btn btn-primary" onclick="showProfessorMode()">üë®‚Äçüè´ Professor</button>
            </div>
        </div>

        <!-- Painel de estat√≠sticas -->
        <div class="stats-panel">
            <div class="stat-card">
                <div class="stat-number" id="totalGames">0</div>
                <div class="stat-label">Jogos hoje</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="accuracy">0%</div>
                <div class="stat-label">Precis√£o</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="bestStreak">0</div>
                <div class="stat-label">Melhor sequ√™ncia</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="currentLevel">F√°cil</div>
                <div class="stat-label">N√≠vel atual</div>
            </div>
        </div>

        <!-- Sele√ß√£o de n√≠vel e configura√ß√µes -->
        <div class="level-section">
            <h3 style="margin-bottom: 15px; text-align: center;">‚öôÔ∏è Configura√ß√µes do Jogo</h3>
            
            <div class="level-selector">
                <button class="level-btn active" onclick="setLevel('easy')" data-level="easy">
                    üòä F√°cil (1-10)
                </button>
                <button class="level-btn" onclick="setLevel('medium')" data-level="medium">
                    üòê M√©dio (1-50)
                </button>
                <button class="level-btn" onclick="setLevel('hard')" data-level="hard">
                    üò§ Dif√≠cil (1-100)
                </button>
            </div>

            <div class="game-settings">
                <div class="setting-group">
                    <label>‚è±Ô∏è Tempo limite:</label>
                    <select id="timeLimit" style="padding: 8px; border-radius: 5px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color);">
                        <option value="0">Sem limite</option>
                        <option value="30">30 segundos</option>
                        <option value="60">1 minuto</option>
                        <option value="120">2 minutos</option>
                    </select>
                </div>
            </div>

            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="enableSum" checked>
                    <label for="enableSum">‚ûï Soma</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="enableSub" checked>
                    <label for="enableSub">‚ûñ Subtra√ß√£o</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="enableMul" checked>
                    <label for="enableMul">‚úñÔ∏è Multiplica√ß√£o</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="enableDiv">
                    <label for="enableDiv">‚ûó Divis√£o</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="enablePow">
                    <label for="enablePow">üî¢ Pot√™ncia</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="enableMod">
                    <label for="enableMod">üìê Resto</label>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o dos n√∫meros -->
        <div class="numbers-section">
            <div class="number-display">
                <div>
                    <div style="margin-bottom: 10px; font-weight: bold;">N√∫mero 1</div>
                    <div class="number-box" id="number1">?</div>
                </div>
                <div>
                    <div style="margin-bottom: 10px; font-weight: bold;">N√∫mero 2</div>
                    <div class="number-box" id="number2">?</div>
                </div>
            </div>
            
            <div class="timer-section">
                <div class="timer" id="timer">‚è±Ô∏è --:--</div>
            </div>
            
            <button class="generate-btn" onclick="generateNumbers()">üé≤ Gerar n√∫meros</button>
        </div>

        <!-- Exerc√≠cios -->
        <div class="exercises hidden" id="exercises"></div>

        <!-- Bot√µes de a√ß√£o -->
        <div class="action-buttons">
            <button class="check-btn hidden" onclick="checkAnswers()" id="checkBtn">
                ‚úÖ Corrigir respostas
            </button>
        </div>

        <!-- Se√ß√£o de pontua√ß√£o -->
        <div class="score-section hidden" id="scoreSection">
            <div class="medal" id="medal"></div>
            <div class="score" id="score"></div>
            <div class="streak-display hidden" id="streakDisplay"></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="resetGame()">üîÑ Novo exerc√≠cio</button>
                <button class="btn btn-primary" onclick="showHistory()">üìä Hist√≥rico</button>
                <button class="btn btn-success" onclick="generateNumbers()">üöÄ Continuar</button>
            </div>
            
            <div class="share-section">
                <button class="share-btn" onclick="shareResult()">üì± Compartilhar</button>
            </div>
        </div>

        <!-- Se√ß√£o de hist√≥rico -->
        <div class="history-section hidden" id="historySection">
            <h3>üìà An√°lise de Desempenho</h3>
            <div id="errorAnalysis"></div>
            <div id="tipsSuggestions"></div>
        </div>
    </div>

    <!-- Modal do modo professor -->
    <div class="modal hidden" id="professorModal">
        <div class="modal-content">
            <h2>üë®‚Äçüè´ Modo Professor</h2>
            <p>Gere exerc√≠cios para imprimir!</p>
            <div style="margin: 20px 0;">
                <label>Quantidade de exerc√≠cios:</label>
                <input type="number" id="printCount" value="20" min="5" max="50" style="width: 60px; padding: 5px; margin: 0 10px;">
            </div>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="generatePrintableExercises()">üìÑ Gerar PDF</button>
                <button class="btn btn-secondary" onclick="closeProfessorMode()">‚ùå Fechar</button>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√µes globais
        let currentLevel = 'easy';
        let currentNum1 = 0;
        let currentNum2 = 0;
        let correctAnswers = 0;
        let totalQuestions = 0;
        let soundEnabled = true;
        let currentStreak = 0;
        let bestStreak = 0;
        let totalGames = 0;
        let totalCorrect = 0;
        let totalAnswers = 0;
        let gameHistory = [];
        let errorPatterns = {};
        let timerInterval = null;
        let timeLeft = 0;

        // N√≠veis de dificuldade
        const levels = {
            easy: { min: 1, max: 10, label: 'F√°cil' },
            medium: { min: 1, max: 50, label: 'M√©dio' },
            hard: { min: 1, max: 100, label: 'Dif√≠cil' }
        };

        // Dicas matem√°ticas
        const mathTips = {
            multiplication: [
                "Para multiplicar por 9: some os d√≠gitos do resultado, deve dar 9!",
                "Para multiplicar por 5: termine em 0 ou 5",
                "Para multiplicar por 11: repita os d√≠gitos (ex: 23√ó11 = 253)"
            ],
            division: [
                "Divis√£o √© o inverso da multiplica√ß√£o",
                "Se n√£o der exato, h√° resto!",
                "Divida sempre pelo maior n√∫mero poss√≠vel"
            ],
            addition: [
                "Some primeiro os n√∫meros que fazem 10",
                "Use os dedos quando precisar",
                "Decomponha n√∫meros grandes"
            ],
            subtraction: [
                "Se o resultado √© negativo, troque a ordem",
                "Use a soma para conferir",
                "Pense em 'quanto falta'"
            ],
            power: [
                "Pot√™ncia √© multiplicar o n√∫mero por ele mesmo",
                "2¬≥ = 2√ó2√ó2 = 8",
                "Qualquer n√∫mero elevado a 0 √© 1"
            ],
            modulo: [
                "Resto √© o que sobra da divis√£o",
                "17√∑5 = 3 resto 2, pois 3√ó5+2=17",
                "Se n√£o tem resto, √© divis√≠vel"
            ]
        };

        // Sons usando Web Audio API
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        function playSound(type) {
            if (!soundEnabled) return;
            
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();
            
            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);
            
            if (type === 'correct') {
                oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(1000, audioContext.currentTime + 0.1);
            } else if (type === 'incorrect') {
                oscillator.frequency.setValueAtTime(300, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(200, audioContext.currentTime + 0.1);
            } else if (type === 'complete') {
                oscillator.frequency.setValueAtTime(523, audioContext.currentTime);
                oscillator.frequency.setValueAtTime(659, audioContext.currentTime + 0.1);
                oscillator.frequency.setValueAtTime(784, audioContext.currentTime + 0.2);
            }
            
            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
            
            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundBtn').textContent = soundEnabled ? 'ON' : 'OFF';
        }

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', newTheme);
        }

        function setLevel(level) {
            currentLevel = level;
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-level="${level}"]`).classList.add('active');
            document.getElementById('currentLevel').textContent = levels[level].label;
        }

        function generateNumbers() {
            const level = levels[currentLevel];
            currentNum1 = Math.floor(Math.random() * (level.max - level.min + 1)) + level.min;
            currentNum2 = Math.floor(Math.random() * (level.max - level.min + 1)) + level.min;
            
            // Para divis√£o, garantir que seja exata em n√≠veis f√°ceis
            if (document.getElementById('enableDiv').checked && currentLevel === 'easy') {
                currentNum1 = currentNum2 * Math.floor(Math.random() * 5 + 1);
            }
            
            // Mostra os n√∫meros com anima√ß√£o
            document.getElementById('number1').textContent = currentNum1;
            document.getElementById('number2').textContent = currentNum2;
            
            createExercises();
            
            // Inicia timer se configurado
            const timeLimit = parseInt(document.getElementById('timeLimit').value);
            if (timeLimit > 0) {
                startTimer(timeLimit);
            } else {
                document.getElementById('timer').textContent = '‚è±Ô∏è Sem limite';
            }
            
            // Mostra se√ß√µes
            document.getElementById('exercises').classList.remove('hidden');
            document.getElementById('checkBtn').classList.remove('hidden');
            document.getElementById('scoreSection').classList.add('hidden');
        }

        function createExercises() {
            const exerciseContainer = document.getElementById('exercises');
            exerciseContainer.innerHTML = '';
            totalQuestions = 0;
            
            const operations = [
                { id: 'enableSum', symbol: '‚ûï', op: '+', name: 'SOMA', calc: (a, b) => a + b, type: 'addition' },
                { id: 'enableSub', symbol: '‚ûñ', op: '‚àí', name: 'SUBTRA√á√ÉO', calc: (a, b) => a - b, type: 'subtraction' },
                { id: 'enableMul', symbol: '‚úñÔ∏è', op: '√ó', name: 'MULTIPLICA√á√ÉO', calc: (a, b) => a * b, type: 'multiplication' },
                { id: 'enableDiv', symbol: '‚ûó', op: '√∑', name: 'DIVIS√ÉO', calc: (a, b) => Math.floor(a / b), type: 'division' },
                { id: 'enablePow', symbol: 'üî¢', op: '^', name: 'POT√äNCIA', calc: (a, b) => Math.pow(a, Math.min(b, 4)), type: 'power' },
                { id: 'enableMod', symbol: 'üìê', op: '%', name: 'RESTO', calc: (a, b) => a % b, type: 'modulo' }
            ];
            
            operations.forEach(operation => {
                if (document.getElementById(operation.id).checked) {
                    totalQuestions++;
                    
                    const card = document.createElement('div');
                    card.className = 'exercise-card';
                    
                    let num1 = currentNum1, num2 = currentNum2;
                    
                    // Ajustes espec√≠ficos para cada opera√ß√£o
                    if (operation.type === 'power') {
                        num2 = Math.min(num2, 4); // Limita pot√™ncia a 4
                    } else if (operation.type === 'division' && num2 === 0) {
                        num2 = 1; // Evita divis√£o por zero
                    } else if (operation.type === 'modulo' && num2 === 0) {
                        num2 = 1; // Evita m√≥dulo por zero
                    } else if (operation.type === 'subtraction' && currentLevel === 'easy' && num2 > num1) {
                        [num1, num2] = [num2, num1]; // Evita negativos no f√°cil
                    }
                    
                    const result = operation.calc(num1, num2);
                    
                    card.innerHTML = `
                        <div class="exercise-title">${operation.symbol} ${operation.name}</div>
                        <div class="exercise-problem">${num1} ${operation.op} ${num2} = </div>
                        <input type="number" class="answer-input" data-type="${operation.type}" 
                               data-correct="${result}" data-num1="${num1}" data-num2="${num2}" placeholder="?">
                        <div class="result"></div>
                        <div class="tip-box hidden"></div>
                    `;
                    
                    exerciseContainer.appendChild(card);
                }
            });
        }

        function startTimer(seconds) {
            timeLeft = seconds;
            updateTimerDisplay();
            
            if (timerInterval) clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(timerInterval);
                    checkAnswers();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `‚è±Ô∏è ${minutes}:${seconds.toString().padStart(2, '0')}`;
            
            if (timeLeft <= 10 && timeLeft > 0) {
                document.getElementById('timer').style.color = '#f44336';
                document.getElementById('timer').style.animation = 'shake 0.5s ease';
            }
        }

        function checkAnswers() {
            if (timerInterval) clearInterval(timerInterval);
            
            correctAnswers = 0;
            const cards = document.querySelectorAll('.exercise-card');
            const currentErrors = [];
            
            cards.forEach(card => {
                const input = card.querySelector('.answer-input');
                const resultDiv = card.querySelector('.result');
                const tipBox = card.querySelector('.tip-box');
                const userAnswer = parseInt(input.value);
                const correctAnswer = parseInt(input.dataset.correct);
                const operationType = input.dataset.type;
                const num1 = parseInt(input.dataset.num1);
                const num2 = parseInt(input.dataset.num2);
                
                if (isNaN(userAnswer)) {
                    resultDiv.textContent = '‚ùì Voc√™ esqueceu de responder!';
                    resultDiv.className = 'result incorrect';
                } else if (userAnswer === correctAnswer) {
                    resultDiv.textContent = '‚úÖ Correto!';
                    resultDiv.className = 'result correct';
                    correctAnswers++;
                    playSound('correct');
                } else {
                    resultDiv.textContent = `‚ùå Errado! Resposta: ${correctAnswer}`;
                    resultDiv.className = 'result incorrect';
                    playSound('incorrect');
                    
                    // Registra erro para an√°lise
                    currentErrors.push({
                        type: operationType,
                        num1: num1,
                        num2: num2,
                        userAnswer: userAnswer,
                        correctAnswer: correctAnswer
                    });
                    
                    // Mostra dica
                    if (mathTips[operationType]) {
                        const tips = mathTips[operationType];
                        const randomTip = tips[Math.floor(Math.random() * tips.length)];
                        tipBox.textContent = `üí° Dica: ${randomTip}`;
                        tipBox.classList.remove('hidden');
                    }
                }
            });
            
            // Atualiza estat√≠sticas
            updateStats(currentErrors);
            showResults();
            
            if (correctAnswers === totalQuestions) {
                playSound('complete');
            }
        }

        function updateStats(errors) {
            totalGames++;
            totalAnswers += totalQuestions;
            totalCorrect += correctAnswers;
            
            // Atualiza streak
            if (correctAnswers === totalQuestions) {
                currentStreak++;
                bestStreak = Math.max(bestStreak, currentStreak);
            } else {
                currentStreak = 0;
            }
            
            // Registra erros
            errors.forEach(error => {
                if (!errorPatterns[error.type]) {
                    errorPatterns[error.type] = [];
                }
                errorPatterns[error.type].push(error);
            });
            
            // Adiciona ao hist√≥rico
            gameHistory.push({
                date: new Date(),
                level: currentLevel,
                correct: correctAnswers,
                total: totalQuestions,
                errors: errors
            });
            
            // Atualiza display
            document.getElementById('totalGames').textContent = totalGames;
            document.getElementById('accuracy').textContent = 
                totalAnswers > 0 ? Math.round((totalCorrect / totalAnswers) * 100) + '%' : '0%';
            document.getElementById('bestStreak').textContent = bestStreak;
        }

        function showResults() {
            document.getElementById('checkBtn').classList.add('hidden');
            document.getElementById('scoreSection').classList.remove('hidden');
            
            const percentage = Math.round((correctAnswers / totalQuestions) * 100);
            
            // Mostra pontua√ß√£o
            document.getElementById('score').textContent = 
                `üéØ Pontua√ß√£o: ${correctAnswers}/${totalQuestions} (${percentage}%)`;
            
            // Mostra medalha
            const medalElement = document.getElementById('medal');
            if (percentage === 100) {
                medalElement.textContent = 'ü•á';
            } else if (percentage >= 80) {
                medalElement.textContent = 'ü•à';
            } else if (percentage >= 60) {
                medalElement.textContent = 'ü•â';
            } else {
                medalElement.textContent = 'üí™';
            }
            
            // Mostra streak
            if (currentStreak > 1) {
                const streakDisplay = document.getElementById('streakDisplay');
                streakDisplay.textContent = `üî• Sequ√™ncia: ${currentStreak} acertos consecutivos!`;
                streakDisplay.classList.remove('hidden');
            }
            
            // Atualiza barra de progresso
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percentage + '%';
            progressFill.textContent = percentage + '%';
        }

        function showHistory() {
            const historySection = document.getElementById('historySection');
            const errorAnalysis = document.getElementById('errorAnalysis');
            const tipsSuggestions = document.getElementById('tipsSuggestions');
            
            historySection.classList.remove('hidden');
            
            // An√°lise de erros
            let analysisHTML = '<h4>üîç An√°lise de Erros:</h4>';
            if (Object.keys(errorPatterns).length === 0) {
                analysisHTML += '<p>‚úÖ Nenhum padr√£o de erro identificado. Continue assim!</p>';
            } else {
                Object.keys(errorPatterns).forEach(type => {
                    const errors = errorPatterns[type];
                    const errorCount = errors.length;
                    const typeNames = {
                        'addition': 'Soma',
                        'subtraction': 'Subtra√ß√£o',
                        'multiplication': 'Multiplica√ß√£o',
                        'division': 'Divis√£o',
                        'power': 'Pot√™ncia',
                        'modulo': 'Resto'
                    };
                    
                    analysisHTML += `
                        <div class="error-analysis">
                            <strong>${typeNames[type]}:</strong> ${errorCount} erro(s)<br>
                            <small>üìù Pratique mais este tipo de opera√ß√£o</small>
                        </div>
                    `;
                });
            }
            
            errorAnalysis.innerHTML = analysisHTML;
            
            // Sugest√µes baseadas no desempenho
            let suggestions = '<h4>üí° Sugest√µes:</h4>';
            const accuracy = totalAnswers > 0 ? (totalCorrect / totalAnswers) * 100 : 0;
            
            if (accuracy < 60) {
                suggestions += '<p>üìö Tente o n√≠vel mais f√°cil para ganhar confian√ßa</p>';
            } else if (accuracy > 90) {
                suggestions += '<p>üöÄ Voc√™ est√° pronto para o pr√≥ximo n√≠vel!</p>';
            } else {
                suggestions += '<p>üëç Continue praticando para melhorar ainda mais</p>';
            }
            
            tipsSuggestions.innerHTML = suggestions;
        }

        function shareResult() {
            const percentage = Math.round((correctAnswers / totalQuestions) * 100);
            const medal = percentage === 100 ? 'ü•á' : percentage >= 80 ? 'ü•à' : percentage >= 60 ? 'ü•â' : 'üí™';
            
            const text = `${medal} Acabei de fazer ${correctAnswers}/${totalQuestions} (${percentage}%) no MATGAME Pro! 
üßÆ N√≠vel: ${levels[currentLevel].label}
üî• Sequ√™ncia atual: ${currentStreak}
üìä Precis√£o geral: ${document.getElementById('accuracy').textContent}

Pratique matem√°tica de forma divertida!`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Meu resultado no MATGAME Pro',
                    text: text
                });
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    alert('üìã Resultado copiado! Cole onde quiser compartilhar.');
                });
            }
        }

        function showProfessorMode() {
            document.getElementById('professorModal').classList.remove('hidden');
        }

        function closeProfessorMode() {
            document.getElementById('professorModal').classList.add('hidden');
        }

        function generatePrintableExercises() {
            const count = parseInt(document.getElementById('printCount').value);
            const level = levels[currentLevel];
            
            let exerciseList = '';
            let answerList = '';
            
            for (let i = 1; i <= count; i++) {
                const num1 = Math.floor(Math.random() * (level.max - level.min + 1)) + level.min;
                const num2 = Math.floor(Math.random() * (level.max - level.min + 1)) + level.min;
                
                const operations = [
                    { symbol: '+', result: num1 + num2 },
                    { symbol: '‚àí', result: num1 - num2 },
                    { symbol: '√ó', result: num1 * num2 },
                    { symbol: '√∑', result: Math.floor(num1 / num2) }
                ];
                
                const randomOp = operations[Math.floor(Math.random() * operations.length)];
                
                exerciseList += `${i}. ${num1} ${randomOp.symbol} ${num2} = _____\n`;
                answerList += `${i}. ${randomOp.result}\n`;
            }
            
            const printContent = `
MATGAME PRO - Lista de Exerc√≠cios
N√≠vel: ${levels[currentLevel].label}
Data: ${new Date().toLocaleDateString('pt-BR')}

EXERC√çCIOS:
${exerciseList}

RESPOSTAS:
${answerList}
            `;
            
            // Cria um blob e faz download
            const blob = new Blob([printContent], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `matgame-exercicios-${new Date().getTime()}.txt`;
            a.click();
            
            closeProfessorMode();
            alert('üìÑ Lista de exerc√≠cios gerada! Verifique seus downloads.');
        }

        function resetGame() {
            document.getElementById('number1').textContent = '?';
            document.getElementById('number2').textContent = '?';
            document.getElementById('exercises').classList.add('hidden');
            document.getElementById('checkBtn').classList.add('hidden');
            document.getElementById('scoreSection').classList.add('hidden');
            document.getElementById('historySection').classList.add('hidden');
            document.getElementById('timer').textContent = '‚è±Ô∏è --:--';
            
            if (timerInterval) clearInterval(timerInterval);
        }

        // Permite usar Enter para corrigir
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !document.getElementById('checkBtn').classList.contains('hidden')) {
                checkAnswers();
            }
        });

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            // Inicia o contexto de √°udio com intera√ß√£o do usu√°rio
            document.addEventListener('click', function() {
                if (audioContext.state === 'suspended') {
                    audioContext.resume();
                }
            }, { once: true });
        });
    </script>
</body>
</html>
