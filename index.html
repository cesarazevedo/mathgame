<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MATGAME Pro - Academia da Matem√°tica</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: var(--bg-gradient);
            color: var(--text-color);
            transition: all 0.3s ease;
            min-height: 100vh;
        }

        /* Temas */
        :root {
            --bg-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --card-bg: white;
            --text-color: #333;
            --border-color: #e0e0e0;
            --primary-color: #667eea;
            --success-color: #4CAF50;
            --error-color: #f44336;
            --warning-color: #ff9800;
        }

        [data-theme="dark"] {
            --bg-gradient: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
            --card-bg: #2c3e50;
            --text-color: #ecf0f1;
            --border-color: #34495e;
            --primary-color: #3498db;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
        }

        .header {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .title {
            font-size: 2.5em;
            font-weight: bold;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }

        .header-controls {
            display: flex;
            gap: 15px;
            align-items: center;
            flex-wrap: wrap;
        }

        .theme-toggle, .btn {
            padding: 10px 15px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s;
            font-weight: bold;
        }

        .theme-toggle {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-secondary {
            background: #9e9e9e;
            color: white;
        }

        .theme-toggle:hover, .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stats-panel {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
        }

        .stat-card {
            text-align: center;
            padding: 15px;
            border: 2px solid var(--border-color);
            border-radius: 10px;
            transition: all 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            border-color: var(--primary-color);
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
        }

        .stat-label {
            font-size: 0.9em;
            margin-top: 5px;
            opacity: 0.8;
        }

        .level-section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .level-selector {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .level-btn {
            padding: 12px 20px;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 1em;
        }

        .level-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .level-btn:hover {
            transform: translateY(-2px);
        }

        .game-settings {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .checkbox-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .numbers-section {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 3px solid var(--primary-color);
        }

        .number-display {
            display: flex;
            justify-content: space-around;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .number-box {
            background: var(--primary-color);
            color: white;
            padding: 20px 30px;
            border-radius: 15px;
            font-size: 1.8em;
            font-weight: bold;
            min-width: 100px;
            text-align: center;
            animation: numberPulse 0.5s ease;
        }

        @keyframes numberPulse {
            0% { transform: scale(0.8); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .timer-section {
            text-align: center;
            margin: 20px 0;
        }

        .timer {
            font-size: 2em;
            font-weight: bold;
            color: var(--primary-color);
            margin: 10px 0;
        }

        .generate-btn {
            background: var(--success-color);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            display: block;
            margin: 0 auto;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .exercises {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }

        .exercise-card {
            background: var(--card-bg);
            border: 2px solid var(--border-color);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .exercise-card:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.15);
        }

        .exercise-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
            color: var(--primary-color);
        }

        .exercise-problem {
            font-size: 1.6em;
            margin: 20px 0;
            color: var(--text-color);
            font-weight: bold;
        }

        .answer-input {
            width: 120px;
            padding: 12px;
            font-size: 1.2em;
            text-align: center;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            margin: 15px 0;
            background: var(--card-bg);
            color: var(--text-color);
            transition: all 0.3s;
        }

        .answer-input:focus {
            border-color: var(--primary-color);
            outline: none;
            transform: scale(1.05);
        }

        .result {
            margin-top: 15px;
            font-weight: bold;
            font-size: 1.1em;
            min-height: 30px;
            padding: 10px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .correct {
            background: rgba(76, 175, 80, 0.1);
            color: var(--success-color);
            border: 2px solid var(--success-color);
            animation: correctPulse 0.6s ease;
        }

        .incorrect {
            background: rgba(244, 67, 54, 0.1);
            color: var(--error-color);
            border: 2px solid var(--error-color);
            animation: shake 0.5s ease;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .tip-box {
            background: rgba(255, 152, 0, 0.1);
            border: 2px solid var(--warning-color);
            color: var(--warning-color);
            padding: 10px;
            border-radius: 8px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        .check-btn {
            background: var(--error-color);
            color: white;
            border: none;
            padding: 20px 50px;
            font-size: 1.3em;
            border-radius: 15px;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .check-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.3);
        }

        .score-section {
            background: var(--card-bg);
            padding: 25px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .score {
            font-size: 1.5em;
            margin: 15px 0;
            font-weight: bold;
        }

        .medal {
            font-size: 3em;
            margin: 20px 0;
            animation: medalSpin 1s ease;
        }

        @keyframes medalSpin {
            0% { transform: rotate(0deg) scale(0); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .streak-display {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            font-size: 1.2em;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
            margin: 15px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(45deg, var(--success-color), #8bc34a);
            border-radius: 10px;
            transition: width 0.8s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
            margin: 20px 0;
        }

        .share-btn {
            background: #25d366;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 0 5px;
            transition: all 0.3s;
        }

        .share-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .hidden {
            display: none !important;
        }

        @media (max-width: 768px) {
            .container { padding: 10px; }
            .header { flex-direction: column; gap: 15px; }
            .title { font-size: 2em; }
            .exercises { grid-template-columns: 1fr; }
            .level-selector { justify-content: center; }
            .game-settings { justify-content: center; }
        }
    </style>
</head>
<body data-theme="light">
    <div class="container">
        <!-- Header com controles -->
        <div class="header">
            <div class="title">üßÆ MATGAME PRO</div>
            <div class="header-controls">
                <button class="theme-toggle" onclick="toggleTheme()">üåô Tema</button>
            </div>
        </div>

        <!-- Painel de estat√≠sticas -->
        <div class="stats-panel">
            <div class="stat-card">
                <div class="stat-number" id="totalGames">0</div>
                <div class="stat-label">Jogos hoje</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="accuracy">0%</div>
                <div class="stat-label">Precis√£o</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="bestStreak">0</div>
                <div class="stat-label">Melhor sequ√™ncia</div>
            </div>
            <div class="stat-card">
                <div class="stat-number" id="currentLevel">F√°cil</div>
                <div class="stat-label">N√≠vel atual</div>
            </div>
        </div>

        <!-- Sele√ß√£o de n√≠vel e configura√ß√µes -->
        <div class="level-section">
            <h3 style="margin-bottom: 15px; text-align: center;">‚öôÔ∏è Configura√ß√µes do Jogo</h3>
            
            <div class="level-selector">
                <button class="level-btn active" onclick="setLevel('easy')" data-level="easy">
                    üòä F√°cil (1-10)
                </button>
                <button class="level-btn" onclick="setLevel('medium')" data-level="medium">
                    üòê M√©dio (1-50)
                </button>
                <button class="level-btn" onclick="setLevel('hard')" data-level="hard">
                    üò§ Dif√≠cil (1-100)
                </button>
            </div>

            <div class="game-settings">
                <div style="display: flex; align-items: center; gap: 10px;">
                    <label>‚è±Ô∏è Tempo limite:</label>
                    <select id="timeLimit" style="padding: 8px; border-radius: 5px; border: 1px solid var(--border-color); background: var(--card-bg); color: var(--text-color);">
                        <option value="0">Sem limite</option>
                        <option value="30">30 segundos</option>
                        <option value="60">1 minuto</option>
                        <option value="120">2 minutos</option>
                    </select>
                </div>
            </div>

            <div class="checkbox-group">
                <div class="checkbox-item">
                    <input type="checkbox" id="enableSum" checked>
                    <label for="enableSum">‚ûï Soma</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="enableSub" checked>
                    <label for="enableSub">‚ûñ Subtra√ß√£o</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="enableMul" checked>
                    <label for="enableMul">‚úñÔ∏è Multiplica√ß√£o</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="enableDiv">
                    <label for="enableDiv">‚ûó Divis√£o</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="enablePow">
                    <label for="enablePow">üî¢ Pot√™ncia</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="enableMod">
                    <label for="enableMod">üìê Resto</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="enableDecimals">
                    <label for="enableDecimals">üî∏ Decimais</label>
                </div>
                <div class="checkbox-item">
                    <input type="checkbox" id="enableFractions">
                    <label for="enableFractions">üç∞ Fra√ß√µes</label>
                </div>
            </div>
        </div>

        <!-- Se√ß√£o dos n√∫meros -->
        <div class="numbers-section">
            <div class="number-display">
                <div>
                    <div style="margin-bottom: 10px; font-weight: bold;">N√∫mero 1</div>
                    <div class="number-box" id="number1">?</div>
                </div>
                <div>
                    <div style="margin-bottom: 10px; font-weight: bold;">N√∫mero 2</div>
                    <div class="number-box" id="number2">?</div>
                </div>
            </div>
            
            <div class="timer-section">
                <div class="timer" id="timer">‚è±Ô∏è --:--</div>
            </div>
            
            <button class="generate-btn" onclick="generateNumbers()">üé≤ Gerar n√∫meros</button>
        </div>

        <!-- Exerc√≠cios -->
        <div class="exercises hidden" id="exercises"></div>

        <!-- Bot√µes de a√ß√£o -->
        <div class="action-buttons">
            <button class="check-btn hidden" onclick="checkAnswers()" id="checkBtn">
                ‚úÖ Corrigir respostas
            </button>
        </div>

        <!-- Se√ß√£o de pontua√ß√£o -->
        <div class="score-section hidden" id="scoreSection">
            <div class="medal" id="medal"></div>
            <div class="score" id="score"></div>
            <div class="streak-display hidden" id="streakDisplay"></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 0%">0%</div>
            </div>
            
            <div class="action-buttons">
                <button class="btn btn-secondary" onclick="resetGame()">üîÑ Novo exerc√≠cio</button>
                <button class="btn btn-success" onclick="generateNumbers()">üöÄ Continuar</button>
            </div>
            
            <div style="text-align: center; margin: 20px 0;">
                <button class="share-btn" onclick="shareResult()">üì± Compartilhar</button>
            </div>
        </div>
    </div>

    <script>
        // Configura√ß√µes globais
        let currentLevel = 'easy';
        let currentNum1 = 0;
        let currentNum2 = 0;
        let correctAnswers = 0;
        let totalQuestions = 0;
        let currentStreak = 0;
        let bestStreak = 0;
        let totalGames = 0;
        let totalCorrect = 0;
        let totalAnswers = 0;
        let timerInterval = null;
        let timeLeft = 0;

        // N√≠veis de dificuldade
        const levels = {
            easy: { min: 1, max: 10, label: 'F√°cil' },
            medium: { min: 1, max: 50, label: 'M√©dio' },
            hard: { min: 1, max: 100, label: 'Dif√≠cil' }
        };

        // Dicas matem√°ticas
        const mathTips = {
            multiplication: [
                "Para multiplicar por 9: some os d√≠gitos do resultado, deve dar 9!",
                "Para multiplicar por 5: termine em 0 ou 5",
                "Para multiplicar por 11: repita os d√≠gitos (ex: 23√ó11 = 253)"
            ],
            division: [
                "Divis√£o √© o inverso da multiplica√ß√£o",
                "Se n√£o der exato, h√° resto!",
                "Divida sempre pelo maior n√∫mero poss√≠vel"
            ],
            addition: [
                "Some primeiro os n√∫meros que fazem 10",
                "Use os dedos quando precisar",
                "Decomponha n√∫meros grandes"
            ],
            subtraction: [
                "Se o resultado √© negativo, troque a ordem",
                "Use a soma para conferir",
                "Pense em 'quanto falta'"
            ],
            power: [
                "Pot√™ncia √© multiplicar o n√∫mero por ele mesmo",
                "2¬≥ = 2√ó2√ó2 = 8",
                "Qualquer n√∫mero elevado a 0 √© 1"
            ],
            modulo: [
                "Resto √© o que sobra da divis√£o",
                "17√∑5 = 3 resto 2, pois 3√ó5+2=17",
                "Se n√£o tem resto, √© divis√≠vel"
            ],
            decimal: [
                "Conte as casas decimais: 1,5 √ó 2,3 = duas casas",
                "Para arredondar: 1,236 vira 1,24 (olhe a 3¬™ casa)",
                "V√≠rgula alinha v√≠rgula na soma e subtra√ß√£o",
                "Na multiplica√ß√£o: ignore a v√≠rgula, depois volte"
            ],
            fraction: [
                "Para somar fra√ß√µes com mesmo denominador: some s√≥ os numeradores",
                "Para simplificar: divida numerador e denominador pelo mesmo n√∫mero",
                "Para comparar fra√ß√µes: transforme em decimal ou use denominador comum",
                "Para multiplicar fra√ß√µes: multiplique numerador com numerador",
                "1/2 = 0,5 = 50% (s√£o iguais, apenas formas diferentes)",
                "Para encontrar fra√ß√µes equivalentes: multiplique em cima e embaixo pelo mesmo n√∫mero"
            ]
        };

        // Fun√ß√µes utilit√°rias para fra√ß√µes
        function gcd(a, b) {
            return b === 0 ? a : gcd(b, a % b);
        }
        
        function simplifyFraction(num, den) {
            const g = gcd(Math.abs(num), Math.abs(den));
            return [num / g, den / g];
        }
        
        function addFractions(n1, d1, n2, d2) {
            const commonDen = d1 * d2 / gcd(d1, d2);
            const newN1 = n1 * (commonDen / d1);
            const newN2 = n2 * (commonDen / d2);
            return simplifyFraction(newN1 + newN2, commonDen);
        }

        function generateFractionExercises() {
            const exercises = [];
            const level = levels[currentLevel];
            const maxNum = Math.min(level.max, 12);
            
            // Tipos de exerc√≠cios de fra√ß√µes
            const types = [
                'equivalence', 'simplify', 'compare', 'add_same', 'subtract_same', 
                'add_diff', 'multiply', 'fraction_to_decimal', 'decimal_to_fraction'
            ];
            
            for (let i = 0; i < 4; i++) {
                const type = types[Math.floor(Math.random() * types.length)];
                const exercise = createFractionExercise(type, maxNum);
                if (exercise) exercises.push(exercise);
            }
            
            return exercises;
        }
        
        function createFractionExercise(type, maxNum) {
            let problem, answer, answerType = 'fraction';
            
            switch (type) {
                case 'equivalence':
                    const num1 = Math.floor(Math.random() * 6) + 1;
                    const den1 = Math.floor(Math.random() * 6) + 2;
                    const multiplier = Math.floor(Math.random() * 3) + 2;
                    const [simpleNum, simpleDen] = simplifyFraction(num1, den1);
                    problem = `Complete: ${simpleNum}/${simpleDen} = ?/${simpleDen * multiplier}`;
                    answer = simpleNum * multiplier;
                    answerType = 'number';
                    break;
                    
                case 'simplify':
                    const factor = Math.floor(Math.random() * 3) + 2;
                    const baseNum = Math.floor(Math.random() * 4) + 1;
                    const baseDen = Math.floor(Math.random() * 4) + 2;
                    const unsimplifiedNum = baseNum * factor;
                    const unsimplifiedDen = baseDen * factor;
                    const [simplifiedNum, simplifiedDen] = simplifyFraction(unsimplifiedNum, unsimplifiedDen);
                    problem = `Simplifique: ${unsimplifiedNum}/${unsimplifiedDen}`;
                    answer = `${simplifiedNum}/${simplifiedDen}`;
                    break;
                    
                case 'compare':
                    const n1 = Math.floor(Math.random() * 5) + 1;
                    const d1 = Math.floor(Math.random() * 5) + 2;
                    const n2 = Math.floor(Math.random() * 5) + 1;
                    const d2 = Math.floor(Math.random() * 5) + 2;
                    const val1 = n1 / d1;
                    const val2 = n2 / d2;
                    problem = `Compare: ${n1}/${d1} ___ ${n2}/${d2} (digite >, < ou =)`;
                    answer = val1 > val2 ? '>' : val1 < val2 ? '<' : '=';
                    answerType = 'text';
                    break;
                    
                case 'add_same':
                    const den = Math.floor(Math.random() * 6) + 2;
                    const num1Add = Math.floor(Math.random() * den);
                    const num2Add = Math.floor(Math.random() * den);
                    const [addNum, addDen] = simplifyFraction(num1Add + num2Add, den);
                    problem = `${num1Add}/${den} + ${num2Add}/${den} = `;
                    answer = addNum === addDen ? '1' : `${addNum}/${addDen}`;
                    break;
                    
                case 'subtract_same':
                    const denSub = Math.floor(Math.random() * 6) + 2;
                    const num1Sub = Math.floor(Math.random() * denSub) + 2;
                    const num2Sub = Math.floor(Math.random() * num1Sub);
                    const [subNum, subDen] = simplifyFraction(num1Sub - num2Sub, denSub);
                    problem = `${num1Sub}/${denSub} - ${num2Sub}/${denSub} = `;
                    answer = subNum === 0 ? '0' : `${subNum}/${subDen}`;
                    break;
                    
                case 'multiply':
                    const n1Mul = Math.floor(Math.random() * 4) + 1;
                    const d1Mul = Math.floor(Math.random() * 4) + 2;
                    const n2Mul = Math.floor(Math.random() * 4) + 1;
                    const d2Mul = Math.floor(Math.random() * 4) + 2;
                    const [mulNum, mulDen] = simplifyFraction(n1Mul * n2Mul, d1Mul * d2Mul);
                    problem = `${n1Mul}/${d1Mul} √ó ${n2Mul}/${d2Mul} = `;
                    answer = `${mulNum}/${mulDen}`;
                    break;
                    
                case 'fraction_to_decimal':
                    const simpleFractions = [[1, 2], [1, 4], [3, 4], [1, 5], [2, 5], [3, 5], [4, 5]];
                    const [fracNum, fracDen] = simpleFractions[Math.floor(Math.random() * simpleFractions.length)];
                    problem = `Converta para decimal: ${fracNum}/${fracDen} = `;
                    answer = (fracNum / fracDen).toString();
                    answerType = 'number';
                    break;
                    
                case 'decimal_to_fraction':
                    const simpleDecimals = [0.5, 0.25, 0.75, 0.2, 0.4, 0.6, 0.8];
                    const decimal = simpleDecimals[Math.floor(Math.random() * simpleDecimals.length)];
                    let decNum, decDen;
                    if (decimal === 0.5) [decNum, decDen] = [1, 2];
                    else if (decimal === 0.25) [decNum, decDen] = [1, 4];
                    else if (decimal === 0.75) [decNum, decDen] = [3, 4];
                    else if (decimal === 0.2) [decNum, decDen] = [1, 5];
                    else if (decimal === 0.4) [decNum, decDen] = [2, 5];
                    else if (decimal === 0.6) [decNum, decDen] = [3, 5];
                    else if (decimal === 0.8) [decNum, decDen] = [4, 5];
                    problem = `Converta para fra√ß√£o: ${decimal} = `;
                    answer = `${decNum}/${decDen}`;
                    break;
                    
                default:
                    return null;
            }
            
            return { type, problem, answer, answerType };
        }

        function validateFractionAnswer(userAnswer, correctAnswer) {
            // Se a resposta correta √© 0 ou 1
            if (correctAnswer === '0' || correctAnswer === '1') {
                return userAnswer === correctAnswer;
            }
            
            // Se a resposta correta n√£o √© fra√ß√£o
            if (!correctAnswer.includes('/')) {
                return parseFloat(userAnswer) === parseFloat(correctAnswer);
            }
            
            // Valida resposta de fra√ß√£o
            if (userAnswer.includes('/')) {
                const userParts = userAnswer.split('/');
                const correctParts = correctAnswer.split('/');
                if (userParts.length !== 2 || correctParts.length !== 2) return false;
                
                const [userNum, userDen] = [parseInt(userParts[0]), parseInt(userParts[1])];
                const [correctNum, correctDen] = [parseInt(correctParts[0]), parseInt(correctParts[1])];
                
                const [userSimpleNum, userSimpleDen] = simplifyFraction(userNum, userDen);
                const [correctSimpleNum, correctSimpleDen] = simplifyFraction(correctNum, correctDen);
                
                return userSimpleNum === correctSimpleNum && userSimpleDen === correctSimpleDen;
            }
            
            return userAnswer === correctAnswer;
        }

        function toggleTheme() {
            const body = document.body;
            const currentTheme = body.getAttribute('data-theme');
            const newTheme = currentTheme === 'light' ? 'dark' : 'light';
            body.setAttribute('data-theme', newTheme);
        }

        function setLevel(level) {
            currentLevel = level;
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-level="${level}"]`).classList.add('active');
            document.getElementById('currentLevel').textContent = levels[level].label;
        }

        function generateNumbers() {
            const useFractions = document.getElementById('enableFractions').checked;
            
            if (useFractions) {
                document.getElementById('number1').textContent = 'üç∞';
                document.getElementById('number2').textContent = 'ü•ß';
                createExercises();
                startTimer();
                showExercises();
                return;
            }
            
            const level = levels[currentLevel];
            const useDecimals = document.getElementById('enableDecimals').checked;
            
            if (useDecimals) {
                const range = level.max - level.min;
                currentNum1 = parseFloat((Math.random() * range + level.min).toFixed(1));
                currentNum2 = parseFloat((Math.random() * range + level.min).toFixed(1));
            } else {
                currentNum1 = Math.floor(Math.random() * (level.max - level.min + 1)) + level.min;
                currentNum2 = Math.floor(Math.random() * (level.max - level.min + 1)) + level.min;
            }
            
            if (document.getElementById('enableDiv').checked && currentLevel === 'easy' && !useDecimals) {
                currentNum1 = currentNum2 * Math.floor(Math.random() * 5 + 1);
            }
            
            document.getElementById('number1').textContent = currentNum1;
            document.getElementById('number2').textContent = currentNum2;
            
            createExercises();
            startTimer();
            showExercises();
        }

        function startTimer() {
            const timeLimit = parseInt(document.getElementById('timeLimit').value);
            if (timeLimit > 0) {
                timeLeft = timeLimit;
                updateTimerDisplay();
                
                if (timerInterval) clearInterval(timerInterval);
                
                timerInterval = setInterval(() => {
                    timeLeft--;
                    updateTimerDisplay();
                    
                    if (timeLeft <= 0) {
                        clearInterval(timerInterval);
                        checkAnswers();
                    }
                }, 1000);
            } else {
                document.getElementById('timer').textContent = '‚è±Ô∏è Sem limite';
            }
        }

        function updateTimerDisplay() {
            const minutes = Math.floor(timeLeft / 60);
            const seconds = timeLeft % 60;
            document.getElementById('timer').textContent = 
                `‚è±Ô∏è ${minutes}:${seconds.toString().padStart(2, '0')}`;
        }

        function showExercises() {
            document.getElementById('exercises').classList.remove('hidden');
            document.getElementById('checkBtn').classList.remove('hidden');
            document.getElementById('scoreSection').classList.add('hidden');
        }

        function createExercises() {
            const exerciseContainer = document.getElementById('exercises');
            exerciseContainer.innerHTML = '';
            totalQuestions = 0;
            
            const useFractions = document.getElementById('enableFractions').checked;
            
            if (useFractions) {
                const fractionExercises = generateFractionExercises();
                fractionExercises.forEach(exercise => {
                    totalQuestions++;
                    
                    const card = document.createElement('div');
                    card.className = 'exercise-card';
                    
                    card.innerHTML = `
                        <div class="exercise-title">üç∞ FRA√á√ïES</div>
                        <div class="exercise-problem">${exercise.problem}</div>
                        <input type="${exercise.answerType === 'number' ? 'number' : 'text'}" 
                               step="0.001" class="answer-input" 
                               data-type="fraction" 
                               data-correct="${exercise.answer}" 
                               data-answer-type="${exercise.answerType}"
                               placeholder="?">
                        <div class="result"></div>
                        <div class="tip-box hidden"></div>
                    `;
                    
                    exerciseContainer.appendChild(card);
                });
                return;
            }
            
            const useDecimals = document.getElementById('enableDecimals').checked;
            const operations = [
                { id: 'enableSum', symbol: '‚ûï', op: '+', name: 'SOMA', calc: (a, b) => a + b, type: 'addition' },
                { id: 'enableSub', symbol: '‚ûñ', op: '‚àí', name: 'SUBTRA√á√ÉO', calc: (a, b) => a - b, type: 'subtraction' },
                { id: 'enableMul', symbol: '‚úñÔ∏è', op: '√ó', name: 'MULTIPLICA√á√ÉO', calc: (a, b) => a * b, type: 'multiplication' },
                { id: 'enableDiv', symbol: '‚ûó', op: '√∑', name: 'DIVIS√ÉO', calc: (a, b) => useDecimals ? a / b : Math.floor(a / b), type: 'division' },
                { id: 'enablePow', symbol: 'üî¢', op: '^', name: 'POT√äNCIA', calc: (a, b) => Math.pow(a, Math.min(Math.floor(b), 4)), type: 'power' },
                { id: 'enableMod', symbol: 'üìê', op: '%', name: 'RESTO', calc: (a, b) => a % b, type: 'modulo' }
            ];
            
            if (useDecimals && document.getElementById('enableDecimals').checked) {
                operations.push({
                    id: 'enableDecimals', 
                    symbol: 'üî∏', 
                    op: 'decimal', 
                    name: 'ARREDONDAMENTO', 
                    calc: (a, b) => Math.round(a * b * 100) / 100, 
                    type: 'decimal'
                });
            }
            
            operations.forEach(operation => {
                if (document.getElementById(operation.id).checked) {
                    totalQuestions++;
                    
                    const card = document.createElement('div');
                    card.className = 'exercise-card';
                    
                    let num1 = currentNum1, num2 = currentNum2;
                    let problemText = '';
                    let result = 0;
                    
                    if (operation.type === 'power') {
                        num2 = Math.min(Math.floor(num2), 4);
                        result = operation.calc(num1, num2);
                    } else if (operation.type === 'division' && num2 === 0) {
                        num2 = 1;
                        result = operation.calc(num1, num2);
                    } else if (operation.type === 'modulo' && (num2 === 0 || useDecimals)) {
                        if (useDecimals) return;
                        num2 = 1;
                        result = operation.calc(num1, num2);
                    } else if (operation.type === 'subtraction' && currentLevel === 'easy' && num2 > num1 && !useDecimals) {
                        [num1, num2] = [num2, num1];
                        result = operation.calc(num1, num2);
                    } else if (operation.type === 'decimal') {
                        problemText = `${num1} √ó ${num2} = ? (arredonde para 2 casas)`;
                        result = operation.calc(num1, num2);
                    } else {
                        result = operation.calc(num1, num2);
                    }
                    
                    if (useDecimals && operation.type !== 'decimal') {
                        result = Math.round(result * 100) / 100;
                    }
                    
                    if (problemText === '') {
                        problemText = `${num1} ${operation.op} ${num2} = `;
                    }
                    
                    card.innerHTML = `
                        <div class="exercise-title">${operation.symbol} ${operation.name}</div>
                        <div class="exercise-problem">${problemText}</div>
                        <input type="number" step="0.01" class="answer-input" data-type="${operation.type}" 
                               data-correct="${result}" data-num1="${num1}" data-num2="${num2}" 
                               data-answer-type="number" placeholder="?">
                        <div class="result"></div>
                        <div class="tip-box hidden"></div>
                    `;
                    
                    exerciseContainer.appendChild(card);
                }
            });
        }

        function checkAnswers() {
            if (timerInterval) clearInterval(timerInterval);
            
            correctAnswers = 0;
            const cards = document.querySelectorAll('.exercise-card');
            
            cards.forEach(card => {
                const input = card.querySelector('.answer-input');
                const resultDiv = card.querySelector('.result');
                const tipBox = card.querySelector('.tip-box');
                const operationType = input.dataset.type;
                const answerType = input.dataset.answerType || 'number';
                
                let userAnswer = input.value.trim();
                let correctAnswer = input.dataset.correct;
                let isCorrect = false;
                
                if (operationType === 'fraction') {
                    if (answerType === 'number') {
                        userAnswer = parseFloat(userAnswer);
                        correctAnswer = parseFloat(correctAnswer);
                        isCorrect = Math.abs(userAnswer - correctAnswer) <= 0.001;
                    } else if (answerType === 'text') {
                        isCorrect = userAnswer.toLowerCase() === correctAnswer.toLowerCase();
                    } else {
                        isCorrect = validateFractionAnswer(userAnswer, correctAnswer);
                    }
                } else {
                    userAnswer = parseFloat(userAnswer);
                    correctAnswer = parseFloat(correctAnswer);
                    
                    if (!isNaN(userAnswer)) {
                        const tolerance = 0.01;
                        isCorrect = Math.abs(userAnswer - correctAnswer) <= tolerance;
                    }
                }
                
                if (userAnswer === '' || isNaN(userAnswer)) {
                    resultDiv.textContent = '‚ùì Voc√™ esqueceu de responder!';
                    resultDiv.className = 'result incorrect';
                } else if (isCorrect) {
                    resultDiv.textContent = '‚úÖ Correto!';
                    resultDiv.className = 'result correct';
                    correctAnswers++;
                } else {
                    let formattedAnswer = correctAnswer;
                    if (operationType !== 'fraction' && typeof correctAnswer === 'number') {
                        formattedAnswer = correctAnswer % 1 === 0 ? 
                            correctAnswer.toString() : 
                            correctAnswer.toFixed(2);
                    }
                    resultDiv.textContent = `‚ùå Errado! Resposta: ${formattedAnswer}`;
                    resultDiv.className = 'result incorrect';
                    
                    if (mathTips[operationType]) {
                        const tips = mathTips[operationType];
                        const randomTip = tips[Math.floor(Math.random() * tips.length)];
                        tipBox.textContent = `üí° Dica: ${randomTip}`;
                        tipBox.classList.remove('hidden');
                    }
                }
            });
            
            updateStats();
            showResults();
        }

        function updateStats() {
            totalGames++;
            totalAnswers += totalQuestions;
            totalCorrect += correctAnswers;
            
            if (correctAnswers === totalQuestions) {
                currentStreak++;
                bestStreak = Math.max(bestStreak, currentStreak);
            } else {
                currentStreak = 0;
            }
            
            document.getElementById('totalGames').textContent = totalGames;
            document.getElementById('accuracy').textContent = 
                totalAnswers > 0 ? Math.round((totalCorrect / totalAnswers) * 100) + '%' : '0%';
            document.getElementById('bestStreak').textContent = bestStreak;
        }

        function showResults() {
            document.getElementById('checkBtn').classList.add('hidden');
            document.getElementById('scoreSection').classList.remove('hidden');
            
            const percentage = Math.round((correctAnswers / totalQuestions) * 100);
            
            document.getElementById('score').textContent = 
                `üéØ Pontua√ß√£o: ${correctAnswers}/${totalQuestions} (${percentage}%)`;
            
            const medalElement = document.getElementById('medal');
            if (percentage === 100) {
                medalElement.textContent = 'ü•á';
            } else if (percentage >= 80) {
                medalElement.textContent = 'ü•à';
            } else if (percentage >= 60) {
                medalElement.textContent = 'ü•â';
            } else {
                medalElement.textContent = 'üí™';
            }
            
            if (currentStreak > 1) {
                const streakDisplay = document.getElementById('streakDisplay');
                streakDisplay.textContent = `üî• Sequ√™ncia: ${currentStreak} acertos consecutivos!`;
                streakDisplay.classList.remove('hidden');
            }
            
            const progressFill = document.getElementById('progressFill');
            progressFill.style.width = percentage + '%';
            progressFill.textContent = percentage + '%';
        }

        function shareResult() {
            const percentage = Math.round((correctAnswers / totalQuestions) * 100);
            const medal = percentage === 100 ? 'ü•á' : percentage >= 80 ? 'ü•à' : percentage >= 60 ? 'ü•â' : 'üí™';
            
            const text = `${medal} Acabei de fazer ${correctAnswers}/${totalQuestions} (${percentage}%) no MATGAME Pro! 
üßÆ N√≠vel: ${levels[currentLevel].label}
üî• Sequ√™ncia atual: ${currentStreak}
üìä Precis√£o geral: ${document.getElementById('accuracy').textContent}

Pratique matem√°tica de forma divertida!`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Meu resultado no MATGAME Pro',
                    text: text
                });
            } else {
                navigator.clipboard.writeText(text).then(() => {
                    alert('üìã Resultado copiado! Cole onde quiser compartilhar.');
                });
            }
        }

        function resetGame() {
            document.getElementById('number1').textContent = '?';
            document.getElementById('number2').textContent = '?';
            document.getElementById('exercises').classList.add('hidden');
            document.getElementById('checkBtn').classList.add('hidden');
            document.getElementById('scoreSection').classList.add('hidden');
            document.getElementById('timer').textContent = '‚è±Ô∏è --:--';
            
            if (timerInterval) clearInterval(timerInterval);
        }

        // Permite usar Enter para corrigir
        document.addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && !document.getElementById('checkBtn').classList.contains('hidden')) {
                checkAnswers();
            }
        });
    </script>
</body>
</html>